#!/bin/sh

# this script concatenates the files it gets into a single pdf 
# and opens the pdf in your browser

# required programs: qpdf, ps2pdf and graphicsmagick

usage(){
	echo "Usage: $(basename $0) files"
}

if (( $# < 1 ))
then
	echo "Please specify the files to concatenate"
	usage
	exit 2
fi

while getopts 'h' c
do
	case $c in
		h) usage; exit;;
	esac
done

echo "Creating backup in /tmp"
cp -r "$1" /tmp/
# cp -i -r "$1" /tmp/
cd "$1"

# extract the first page of the exercise
# find ./ -name "*.pdf" -exec qpdf --empty --pages {} 1-1 -- firstPage.pdf \;

# write student number on the first page
# qpdf firstPage.pdf --underlay ../firstPage_text.pdf -- firstPage_edited.pdf

# convert all images to pdf
gm convert -page A4+0+0 *.jpg images.pdf

# stitch all pages together
# qpdf --empty --pages images.pdf -- "stitched.pdf"

# optimize pdf
ps2pdf -dPDFSETTINGS=/ebook images.pdf final.pdf

firefox final.pdf
